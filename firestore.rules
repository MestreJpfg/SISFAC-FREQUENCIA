/**
 * @fileoverview Firestore Security Rules for the school attendance tracker.
 *
 * Core Philosophy:
 * This ruleset prioritizes simplicity and security during the prototyping phase.
 * It allows full read access to all data and enforces that writes can only be
 * performed by authenticated users. This is suitable for an internal tool
 * where all authenticated users (even anonymous ones) are considered trusted operators.
 *
 * Data Structure:
 * - /students/{studentId}: Stores individual student data.
 * - /attendance/{attendanceId}: Stores individual attendance records.
 *
 * Key Security Decisions:
 * - Full read access is granted to all users, including unauthenticated users.
 * - Write access (create, update, delete) is restricted to any signed-in user.
 * - No listing restrictions are applied during prototyping, allowing all clients to list any collections.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read student data, but only signed-in users can write.
     * @path /students/{studentId}
     * @allow (get, list): Any user can read all student profiles.
     * @allow (create, update, delete): Any signed-in user can manage student records.
     * @principle Allows public read access and authenticated write access for this internal tool.
     */
    match /students/{studentId} {
      allow get, list: if true;
      allow write: if isSignedIn();
    }

    /**
     * @description Allows anyone to read attendance records, but only signed-in users can write.
     * @path /attendance/{attendanceId}
     * @allow (get, list): Any user can read all attendance records.
     * @allow (create, update, delete): Any signed-in user can manage attendance records.
     * @principle Allows public read access and authenticated write access for this internal tool.
     */
    match /attendance/{attendanceId} {
      allow get, list: if true;
      allow write: if isSignedIn();
    }
  }

  function isSignedIn() {
    return request.auth != null;
  }
}

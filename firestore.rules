/**
 * @fileoverview Firestore Security Rules for the school attendance tracker.
 *
 * Core Philosophy:
 * This ruleset prioritizes simplicity and functionality for an internal tool.
 * It allows any authenticated user (including anonymous ones) to read and write
 * all data, which is necessary for the app's core features like batch
 * attendance updates and data imports.
 *
 * Data Structure:
 * - /students/{studentId}: Stores individual student data.
 * - /attendance/{attendanceId}: Stores individual attendance records.
 *
 * Key Security Decisions:
 * - Read and Write access (get, list, create, update, delete) is restricted to any signed-in user.
 *   This is suitable for this internal application where all operators are trusted.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any signed-in user to read and write student data.
     * @path /students/{studentId}
     * @allow (read, write): Any signed-in user can manage student records.
     * @principle Aligns with the internal tool model where all authenticated users are operators.
     */
    match /students/{studentId} {
      allow read, write: if isSignedIn();
    }

    /**
     * @description Allows any signed-in user to read and write attendance records.
     * @path /attendance/{attendanceId}
     * @allow (read, write): Any signed-in user can manage attendance records.
     * @principle Aligns with the internal tool model where all authenticated users are operators.
     */
    match /attendance/{attendanceId} {
      allow read, write: if isSignedIn();
    }
  }

  function isSignedIn() {
    return request.auth != null;
  }
}

/**
 * @file Firestore Security Rules
 * @description This ruleset provides basic read and write access to student and attendance data, restricting modifications to authenticated users only.
 *
 * Core Philosophy:
 * The security model prioritizes ease of use for prototyping and testing, while ensuring authenticated access. It assumes all users of the application are trusted, but requires authentication for any data modification.  In a production environment, implement a stricter authorization model using a dedicated roles or permissions system.
 *
 * Data Structure:
 * - /students/{studentId}: Stores student profiles.
 * - /attendance/{attendanceId}: Stores individual attendance records.
 *
 * Key Security Decisions:
 * - Authenticated Writes: Only authenticated users can create, update, or delete student or attendance records. This prevents unauthorized modifications of the dataset, but any authenticated user can make modifications.
 * - No Data Validation: Data validation (beyond ownership) is not enforced, allowing for rapid prototyping and schema iteration.
 * - Public Reads: Both students and attendance records are publicly readable to enable easy data exploration within the app. In a production environment, consider restricting data to specific user roles.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants read access to all and requires authentication for writes to student records.
     * @path /students/{studentId}
     * @allow (get, list): Any user can read student data.
     * @allow (create, update, delete): Any authenticated user can modify student data.
     * @deny (create, update, delete): Unauthenticated users cannot modify student data.
     * @principle Authenticated users can read student data.
     */
    match /students/{studentId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Grants read access to all and requires authentication for writes to attendance records.
     * @path /attendance/{attendanceId}
     * @allow (get, list): Any user can read attendance data.
     * @allow (create, update, delete): Any authenticated user can modify attendance data.
     * @deny (create, update, delete): Unauthenticated users cannot modify attendance data.
     * @principle Authenticated users can modify attendance records.
     */
    match /attendance/{attendanceId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Helper function to check if a user is signed in.
     */
    function isSignedIn() {
      return request.auth != null;
    }
  }
}
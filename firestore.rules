/**
 * @file Firestore Security Rules
 * @core_philosophy This ruleset implements a public read, owner-write security model.
 * @data_structure The Firestore database contains two top-level collections: 'students' and 'attendance'.
 * @key_security_decisions Students are publicly listable. Only authenticated users can create, update, and delete students. Attendance records are publicly listable. Only authenticated users can create, update, and delete attendance records.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    /**
     * @description Allows public reading of student profiles. Only authenticated users can create, update, or delete student profiles.
     * @path /students/{studentId}
     * @allow (get, list): Any user can read student data.
     * @allow (create): Any authenticated user can create a student profile.
     * @allow (update, delete): Only authenticated users can update or delete student profiles.
     * @deny (create): Unauthenticated users cannot create student profiles.
     * @deny (update, delete): Unauthenticated users cannot update or delete student profiles.
     * @principle Allows public reading while restricting write access to authenticated users.
     */
    match /students/{studentId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows public reading of attendance records. Only authenticated users can create, update, or delete attendance records.
     * @path /attendance/{attendanceId}
     * @allow (get, list): Any user can read attendance data.
     * @allow (create): Any authenticated user can create an attendance record.
     * @allow (update, delete): Only authenticated users can update or delete attendance records.
     * @deny (create): Unauthenticated users cannot create attendance records.
     * @deny (update, delete): Unauthenticated users cannot update or delete attendance records.
     * @principle Allows public reading while restricting write access to authenticated users.
     */
    match /attendance/{attendanceId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }
  }

  // Helper function to check if a user is signed in
  function isSignedIn() {
    return request.auth != null;
  }
}
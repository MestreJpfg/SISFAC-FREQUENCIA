/**
 * @fileoverview Firestore Security Rules for Attendance Tracker
 *
 * Core Philosophy:
 * This ruleset enforces a strict user-ownership model for student data,
 * allowing only the authenticated user (acting as an admin) to manage student records.
 * Attendance records are writeable by authenticated users and readable by all users.
 *
 * Data Structure:
 * - /students/{studentId}: Stores individual student profiles.
 * - /attendance/{attendanceId}: Stores individual attendance records.
 *
 * Key Security Decisions:
 * - Students collection: Create, update, and delete operations are restricted to authenticated users.
 * - Attendance collection: Create, update, and delete operations are restricted to authenticated users, and are readable by all users.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to the /students collection.
     * @path /students/{studentId}
     * @allow (create) Authenticated user can create a student record.
     * @deny (create) Unauthenticated user cannot create a student record.
     * @allow (get, list) Authenticated user can get and list student records.
     * @deny (get, list) Unauthenticated user cannot get and list student records.
     * @allow (update, delete) Authenticated user can update and delete student records.
     * @deny (update, delete) Unauthenticated user cannot update and delete student records.
     * @principle Enforces authentication for all operations on student records.
     */
    match /students/{studentId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to the /attendance collection.
     * @path /attendance/{attendanceId}
     * @allow (create) Authenticated user can create an attendance record.
     * @deny (create) Unauthenticated user cannot create an attendance record.
     * @allow (get, list) Any user can get and list attendance records.
     * @allow (update, delete) Authenticated user can update and delete attendance records.
     * @deny (update, delete) Unauthenticated user cannot update and delete attendance records.
     * @principle Allows public read access but enforces authentication for write operations on attendance records.
     */
    match /attendance/{attendanceId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }

  // Helper function to determine if a user is signed in.
  function isSignedIn() {
    return request.auth != null;
  }
}